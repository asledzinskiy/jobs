- project:
    name: tools
    jobs:
      - 'build-vm-{distro}-images'
      - k8s-repo-cloner
      - k8s-repo-cloner-runner
      - gerrit-projects.update
      - gerrit-projects.test
      - jenkins-jobs.update
      - jenkins-jobs.test
      - prepare-slave-nodes
    distro:
      - ubuntu

- project:
    name: mcp
    jobs:
      - mcp-build-debian-base
      - mcp-build-run-tests
      - mcp-k8s-e2e-conformance
      - mcp-k8s-hyperkube
      - mcp-k8s-hyperkube-ci
      - mcp-k8s-hyperkube-test-all
      - mcp-k8s-images
      - mcp-k8s-test-integration
      - mcp-k8s-test-unit-with-coverage
      - mcp-k8s-test-unit
      - mcp-k8s-conformance-test-runner
      - mcp-k8s-conformance-test-runner-ci
      - mcp-lint-test
      - mcp-prepare-env
      - mcp-k8s-merge-pipeline
      - mcp-k8s-test-pipeline

- project:
    name: calico-build-calico
    jobs:
      - calico-build-calico
      - calico-build-calico-gate

- project:
    name: calico-build-calico-bird
    jobs:
      - calico-build-calico-bird
      - calico-build-calico-bird-gate

- project:
    name: calico-build-confd
    jobs:
      - calico-build-confd
      - calico-build-confd-gate

- project:
    name: calico-build-calico-containers
    jobs:
      - calico-build-calico-containers
      - calico-build-calico-containers-gate

- project:
    name: calico-build-calico-cni
    jobs:
      - calico-build-calico-cni
      - calico-build-calico-cni-gate

- project:
    name: calico-build-libcalico
    jobs:
      - calico-build-libcalico
      - calico-build-libcalico-gate

- project:
    name: calico-pep8
    jobs:
      - calico-pep8-{project-name}
    project-name:
      - calico

- project:
    name: calico-unit-tests
    jobs:
      - calico-unit-test
      - calico-containers-unit-test
      - libcalico-unit-test
      - calico-confd-unit-test
      - calico-cni-unit-test

- project:
    name: mcp-netchecker-unit-tests
    jobs:
    - '{project-name}-tox-{testenv}':
        project-name: mcp-netchecker-agent
        project-space: mcp-netchecker
        testenv:
          - pep8
          - shellcheck
    - '{project-name}-tox-{testenv}':
        project-name: mcp-netchecker-server
        project-space: mcp-netchecker
        testenv:
          - py27
          - py34
          - py35
          - pep8

- project:
    name: mcp-netchecker-build
    jobs:
    - 'mcp-netchecker-{type}-build':
        type:
          - server
          - agent

- project:
    name: mcp-netchecker-gate
    jobs:
    - 'mcp-netchecker-{type}-gate':
        type:
          - server
          - agent

- project:
    name: system-tests
    # TODO(apanchenko): take the latest image from artifactory
    image_link: 'http://jenkins-storage.ng.mirantis.net/images/images.lst'
    image_path: '/home/jenkins/images/ubuntu-1604-server.qcow2'
    jobs:
    - 'mcp-netchecker-{type}-test-all':
        type:
          - server
          - agent
    - '{project-name}.system-test.{test-name}':
        project-name: 'mcp-netchecker-agent'
        project-space: 'mcp-netchecker'
        test-name: 'deploy'
        project-to-clone: mcp-netchecker-server
    - '{project-name}.system-test.{test-name}':
        project-name: 'mcp-netchecker-server'
        project-space: 'mcp-netchecker'
        test-name: 'deploy'
        project-to-clone: mcp-netchecker-agent
    - 'calico.system-test.{test-name}':
        test-name: 'deploy'
    - 'mcp.system-test.custom'


- project:
    name: pipeline-calico
    jobs:
      - pipeline-calico-bird
      - pipeline-calico-cni
      - pipeline-calico-confd
      - pipeline-calico-containers
      - pipeline-calico-felix
      - pipeline-calico-libcalico
      - pipeline-calico-libcalico-go

- project:
    name: pipeline-calico-gate
    jobs:
      - pipeline-calico-bird-gate
      - pipeline-calico-cni-gate
      - pipeline-calico-confd-gate
      - pipeline-calico-containers-gate
      - pipeline-calico-felix-gate
      - pipeline-calico-libcalico-gate
      - pipeline-calico-libcalico-go-gate

- project:
    name: sync-upstream-repos
    jobs:
       - 'sync-upstream'

- project:
    name: 'calico-sync-mcp'
    sync-node: 'sync-code'

    # Branches to sync (see also short names below)
    upstream-branch: 'master'
    downstream-branch: 'mcp'
    fallback-branch: 'master'

    # Branch short names for jobs naming
    src-branch: master
    dst-branch: mcp

    # Syncronization schedule
    timer: '@midnight'

    # Gerrit parameters
    gerrit-user: 'mcp-ci-mirroring'
    gerrit-creds: 'mcp-ci-mirroring'
    gerrit-topic: 'sync/{src-branch}/{dst-branch}'
    gerrit-reviewers: 'calico-core'

    # List of projects to sync
    gerrit-project-name:
    - 'calico-cni'
    - 'calico-containers'
    - 'confd'
    - 'felix'
    - 'libcalico'
    - 'libcalico-go'

    jobs:
    - 'sync-{gerrit-project-name}-{src-branch}-{dst-branch}'

- project:
    name: 'calico-bird-sync-mcp'
    sync-node: 'sync-code'

    # Branches to sync (see also short names below)
    upstream-branch: 'feature-ipinip'
    downstream-branch: 'mcp'
    fallback-branch: 'feature-ipinip'

    # Branch short names for jobs naming
    src-branch: feature-ipinip
    dst-branch: mcp

    # Syncronization schedule
    timer: '@midnight'

    # Gerrit parameters
    gerrit-user: 'mcp-ci-mirroring'
    gerrit-creds: 'mcp-ci-mirroring'
    gerrit-topic: 'sync/{src-branch}/{dst-branch}'
    gerrit-reviewers: 'calico-core'

    # List of projects to sync
    gerrit-project-name:
    - 'calico-bird'

    jobs:
    - 'sync-{gerrit-project-name}-{src-branch}-{dst-branch}'

- project:
    name: mcp-ci-infra
    jobs:
    - '{project-name}-tox-{testenv}':
        project-name: gitrepo
        project-space: mcp-ci
        testenv:
          - py27
          - py35
          - pep8

- project:
    name: download-mcp-systest-image
    jobs:
       - 'download-mcp-systest-image'

- project:
    name: 'k8s-gate-tests'
    image_link: 'http://jenkins-storage.ng.mirantis.net/images/images.lst'
    image_path: '/home/jenkins/images/ubuntu-1604-server.qcow2'
    timeout: 360
    description: 'k8s gate tests'
    weight: '1'
    jobs:
     - 'k8s.system-test.{test-mark}':
         test-mark: 'k8s_installed_custom'

- project:
    name: tcp-build
    jobs:
      - 'build-docker-openstack-{version}-{branch}-{os-project}':
          branch: mitaka
          version: 9.0
      - 'build-docker-openstack-{version}-{branch}-{os-project}':
          branch: newton
          version: 10.0
      - 'build-docker-openstack-{version}-{branch}-neutron':
          branch: mitaka
          version: 9.0
      - 'build-docker-openstack-{version}-{branch}-neutron':
          branch: newton
          version: 10.0
      - 'build-opencontrail-oc30-debian-jessie'
      - 'build-docker-opencontrail-oc30'
      - 'build-docker-{component}'
    os-project:
      - cinder
      - glance
      - heat
      - keystone
      - nova
    component:
      - calico
      - galera
      - hyperkube
      - libvirt
      - memcached
      - rabbitmq
