- project:
    name: tools
    jobs:
      - 'build-vm-{distro}-images'
      - k8s-repo-cloner
      - k8s-repo-cloner-runner
      - gerrit-projects.update
      - gerrit-projects.test
      - jenkins-jobs.update
      - jenkins-jobs.test
      - prepare-slave-nodes
    distro:
      - ubuntu

- project:
    name: mcp
    jobs:
      - mcp-build-base-slave-image-test-pipeline
      - mcp-build-base-slave-image-merge-pipeline
      - mcp-build-debian-base
      - mcp-build-run-tests
      - mcp-k8s-images-pipeline
      - mcp-lint-test
      - mcp-prepare-env
      - mcp-k8s-merge-pipeline
      - mcp-k8s-test-pipeline
      - mcp-k8s-coverage-timer-pipeline
      - mcp-k8s-hyperkube-custom
      - mcp-qa-pipeline

- project:
    name: mcp-netchecker-build
    jobs:
    - 'mcp-netchecker-{type}-build':
        type:
          - server
          - agent

- project:
    name: mcp-netchecker-gate
    jobs:
    - 'mcp-netchecker-{type}-gate':
        type:
          - server
          - agent

- project:
    name: mcp-netchecker-pipeline
    jobs:
      - mcp-netchecker-agent-pipeline
      - mcp-netchecker-agent-merge-pipeline
      - mcp-netchecker-server-pipeline
      - mcp-netchecker-server-merge-pipeline

- project:
    name: system-tests
    # TODO(apanchenko): take the latest image from artifactory
    image_link: 'http://share01-scc.ng.mirantis.net/images.lst'
    image_path: '/home/jenkins/images/ubuntu-1604-server.qcow2'
    jobs:
    - 'mcp-netchecker-{type}-test-all':
        type:
          - server
          - agent
    - '{project-name}.system-test.{test-name}':
        project-name: 'mcp-netchecker-agent'
        project-space: 'mcp-netchecker'
        test-name: 'deploy'
        project-to-clone: mcp-netchecker-server
    - '{project-name}.system-test.{test-name}':
        project-name: 'mcp-netchecker-server'
        project-space: 'mcp-netchecker'
        test-name: 'deploy'
        project-to-clone: mcp-netchecker-agent
    - 'calico.system-test.{test-name}':
        test-name: 'deploy'
    - 'mcp.system-test.custom'


- project:
    name: calico-pipeline
    jobs:
      - calico-bird-pipeline
      - calico-cni-pipeline
      - calico-confd-pipeline
      - calico-containers-pipeline
      - calico-felix-pipeline
      - calico-libcalico-go-pipeline
      - calico-libcalico-pipeline
      - calicoctl-pipeline

- project:
    name: calico-merge-pipelines
    jobs:
      - calico-bird-merge-pipeline
      - calico-cni-merge-pipeline
      - calico-confd-merge-pipeline
      - calico-containers-merge-pipeline
      - calico-felix-merge-pipeline
      - calico-libcalico-go-merge-pipeline
      - calico-libcalico-merge-pipeline
      - calicoctl-merge-pipeline

- project:
    name: sync-upstream-repos
    project-namespace:
      - 'calico'
      - 'fuel-ccp'
      - 'kubernetes'
      - 'mk'
      - 'tcp'
    jobs:
      - 'sync-upstream-MANUAL'
      - 'sync-upstream-{project-namespace}'

- project:
    name: 'calico-sync-mcp'
    sync-node: 'sync-code'

    # Branches to sync (see also short names below)
    upstream-branch: 'master'
    downstream-branch: 'mcp'
    fallback-branch: 'master'

    # Branch short names for jobs naming
    src-branch: master
    dst-branch: mcp

    # Syncronization schedule
    timer: '@midnight'

    # Gerrit parameters
    gerrit-user: 'mcp-ci-mirroring'
    gerrit-creds: 'mcp-ci-mirroring'
    gerrit-topic: 'sync/{src-branch}/{dst-branch}'
    gerrit-reviewers: 'calico-core'

    # List of projects to sync
    gerrit-project-name:
    - 'cni-plugin'
    - 'calicoctl'
    - 'confd'
    - 'felix'
    - 'libcalico'
    - 'libcalico-go'

    jobs:
    - 'sync-downstream-{gerrit-project-name}-{src-branch}-{dst-branch}'

- project:
    name: 'calico-bird-sync-mcp'
    sync-node: 'sync-code'

    # Branches to sync (see also short names below)
    upstream-branch: 'feature-ipinip'
    downstream-branch: 'mcp'
    fallback-branch: 'feature-ipinip'

    # Branch short names for jobs naming
    src-branch: feature-ipinip
    dst-branch: mcp

    # Syncronization schedule
    timer: '@midnight'

    # Gerrit parameters
    gerrit-user: 'mcp-ci-mirroring'
    gerrit-creds: 'mcp-ci-mirroring'
    gerrit-topic: 'sync/{src-branch}/{dst-branch}'
    gerrit-reviewers: 'calico-core'

    # List of projects to sync
    gerrit-project-name:
    - 'bird'

    jobs:
    - 'sync-downstream-{gerrit-project-name}-{src-branch}-{dst-branch}'

- project:
    name: ceph-decapod
    jobs:
      - ceph-decapod-backend-test-pipeline
      - ceph-decapod-frontend-build-ui-image
      - ceph-decapod-frontend-test-pipeline
      - ceph-decapod-images-merge-pipeline
      - ceph-decapod-images-test-pipeline
      - ceph-whale-checks-pipeline
      - ceph-whale-test-pipeline

- project:
    name: ccp
    jobs:
      - ccp-docker-build:
          timer: '@midnight'
      - ccp-tempest-test
      - ccp-docker-deploy

- project:
    name: mcp-ci-infra
    jobs:
    - '{project-name}-tox-{testenv}':
        project-name: gitrepo
        project-space: mcp-ci
        testenv:
          - py27
          - py35
          - pep8

- project:
    name: download-mcp-systest-image
    image_link: 'http://share01-scc.ng.mirantis.net/images.lst'
    image_path: '/home/jenkins/images/ubuntu-1604-server.qcow2'
    jobs:
       - 'download-mcp-systest-image'

- project:
    name: 'k8s-gate-tests'
    image_link: 'http://share01-scc.ng.mirantis.net/images.lst'
    image_path: '/home/jenkins/images/ubuntu-1604-server.qcow2'
    timeout: 360
    description: 'k8s gate tests'
    weight: '1'
    jobs:
     - 'k8s.system-test.{test-mark}':
         test-mark: 'k8s_installed_custom'

- project:
    name: 'mcp-ccp-tests'
    image_link: 'http://share01-scc.ng.mirantis.net/images.lst'
    image_path: '/home/jenkins/images/ubuntu-1604-server.qcow2'
    timeout: 360
    description: 'fuel-ccp tests'
    weight: '1'
    jobs:
     - 'mcp.ccp.{test-mark}':
         test-mark:
          - system_few_os
          - galera
          - rabbitmq
         conf-file-name: 'five_slaves.yaml'
     - 'mcp.ccp.{test-mark}':
         test-mark: smoke

- project:
    name: tcp-build
    jobs:
      - 'build-docker-openstack-{version}-{branch}-{os-project}':
          branch: mitaka
          version: 9.0
      - 'build-docker-openstack-{version}-{branch}-{os-project}':
          branch: newton
          version: 10.0
      - 'build-docker-openstack-{version}-{branch}-neutron':
          branch: mitaka
          version: 9.0
      - 'build-docker-openstack-{version}-{branch}-neutron':
          branch: newton
          version: 10.0
      - 'build-opencontrail-oc30-debian-jessie'
      - 'build-docker-opencontrail-oc30'
      - 'build-docker-{component}'
    os-project:
      - cinder
      - glance
      - heat
      - keystone
      - nova
    component:
      - calico
      - galera
      - hyperkube
      - libvirt
      - memcached
      - rabbitmq

- project:
    name: 'mk-kubernetes-deploy-pipeline'
    jobs:
     - 'mk-kubernetes-deploy-pipeline'

- project:
    name: clusters
    jobs:
      - "{cluster}-configure-system"
      - "{cluster}-deploy-k8s"
    cluster:
      - env-01
