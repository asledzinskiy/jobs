- job-template:
    name: update-gerrit-projects
    description: |
      Update Gerrit projects after the merge event
    node: tools
    builders:
      - shell:
          !include-raw-escape: builders/update-gerrit-projects.sh
    concurrent: false
    scm:
      - git:
          branches:
            - 'master'
          remotes:
            - gerrit:
                url: 'ssh://mcp-ci-gerrit@{gerrit-host}:29418/mcp-ci/project-config.git'
                credentials-id: 'mcp-ci-gerrit'
          skip-tag: true
    triggers:
      - gerrit:
          trigger-on:
            - change-merged-event
          projects:
            - project-compare-type: PLAIN
              project-pattern: 'mcp-ci/project-config'
              branches:
                - branch-compare-type: ANT
                  branch-pattern: '**'
              file-paths:
                - compare-type: ANT
                  pattern: '**/gerrit/**'
          custom-url: '* $JOB_NAME $BUILD_URL'
